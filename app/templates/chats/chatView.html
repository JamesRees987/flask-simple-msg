{% extends "base.html" %} {% block title %}{{ chat.chat_name }} - Simple Message
App{% endblock %} {% block content %}
<div class="container-fluid" style="height: calc(100vh - 180px)">
  <div class="row h-100">
    <!-- Chat Window -->
    <div class="col-12 d-flex flex-column h-100">
      <!-- Chat Header -->
      <!-- Chat Header -->
      <div
        class="bg-light border-bottom p-3 d-flex align-items-center justify-content-between"
      >
        <div class="d-flex align-items-center">
          <!-- Back Button -->
          <a
            href="{{ url_for('chat.myChat', email=current_user.email) }}"
            class="btn btn-outline-secondary btn-sm me-3"
          >
            <i class="bi bi-arrow-left"></i> Back
          </a>

          <!-- Chat Info -->
          <img
            src="{{ url_for('chat.chat_image', chat_id=chat.id) }}"
            alt="{{ chat.chat_name }}"
            class="rounded-circle me-3"
            style="width: 50px; height: 50px; object-fit: cover"
          />
          <div>
            <h5 class="mb-0">{{ chat.chat_name }}</h5>
            <h5 class="mb-0 small">{{ chat.chat_description }}</h5>
            {% if other_user %}
            <small class="text-muted">
              <i
                class="bi bi-circle-fill text-secondary"
                style="font-size: 0.5rem"
              ></i>
              {{ other_user.username }}
            </small>
            <!-- WEBSOCKET TODO: Update online status dynamically -->
            {% endif %}
          </div>
        </div>

        <!-- Settings Button -->
        <a
          href="{{ url_for('chat.chatSettings', chat_id=chat.id) }}"
          class="btn btn-outline-secondary"
        >
          <i class="bi bi-gear-fill"></i>
        </a>
      </div>
      <!-- Messages Container -->
      <div
        class="flex-grow-1 overflow-auto p-4"
        id="messagesContainer"
        style="background-color: #f8f9fa"
      >
        <!-- BACKEND TODO: Load messages from database
             messages = Message.query.filter_by(chat_id=chat.id).order_by(Message.timestamp).all()
        -->

        {% if messages %} {% for message in messages %} {% if message.sender_id
        == current_user.id %}
        <!-- Sent Message (Right side, blue) -->
        <div class="mb-3 d-flex justify-content-end">
          <div class="text-end" style="max-width: 70%">
            <div class="bg-primary text-white rounded-3 p-3 shadow-sm">
              <p class="mb-0">{{ message.content }}</p>
            </div>
            <small class="text-muted"
              >{{ message.timestamp.strftime('%I:%M %p') }}</small
            >
          </div>
        </div>
        {% else %}
        <!-- Received Message (Left side, white) -->
        <div class="mb-3 d-flex justify-content-start">
          <div style="max-width: 70%">
            <div class="bg-white rounded-3 p-3 shadow-sm">
              <p class="mb-0">{{ message.content }}</p>
            </div>
            <small class="text-muted"
              >{{ message.timestamp.strftime('%I:%M %p') }}</small
            >
          </div>
        </div>
        {% endif %} {% endfor %} {% else %}
        <!-- Empty State -->
        <div class="text-center mt-5">
          <i class="bi bi-chat-text display-1 text-muted"></i>
          <p class="text-muted mt-3">
            No messages yet. Start the conversation!
          </p>
        </div>
        {% endif %}
      </div>

      <!-- Message Input -->
      <div class="bg-white border-top p-3">
        <form id="messageForm" class="d-flex gap-2">
          <input type="hidden" id="chatId" value="{{ chat.id }}" />
          <!-- WEBSOCKET TODO: Use this chat_id when sending messages -->

          <textarea
            class="form-control"
            placeholder="Type your message..."
            id="messageInput"
            rows="1"
            style="resize: none"
            required
          ></textarea>
          <!-- JAVASCRIPT: Auto-expand textarea on input (in chat_view.js) -->

          <button type="submit" class="btn btn-primary px-4">
            <i class="bi bi-send-fill"></i>
          </button>
        </form>
        <!-- WEBSOCKET TODO: On submit, emit message via Socket.IO
             socket.emit('send_message', {
               chat_id: chatId,
               message: messageText
             });
        -->
      </div>
    </div>
  </div>
</div>
{% endblock %} {% block scripts %}
<script src="{{ url_for('static', filename='js/chatView.js') }}"></script>
{% endblock %}
