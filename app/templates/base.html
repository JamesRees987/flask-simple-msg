<!DOCTYPE html>
<html lang="en" data-bs-theme="light">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>{% block title %}Simple Message App{% endblock %}</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='css/site.css') }}"
    />
    <!-- Favicon (PNG) - place your PNG files in static/img/ as instructed -->
    <!-- Use the provided PNG as favicon for multiple sizes (keeps it simple) -->
    <!-- Favicons: ICO + PNG variants for broad compatibility -->
    <link
      rel="icon"
      href="{{ url_for('static', filename='img/favicon.ico') }}"
    />
    <link
      rel="icon"
      type="image/png"
      sizes="32x32"
      href="{{ url_for('static', filename='img/favicon-32x32.png') }}"
    />
    <link
      rel="icon"
      type="image/png"
      sizes="16x16"
      href="{{ url_for('static', filename='img/favicon-16x16.png') }}"
    />
    <link
      rel="apple-touch-icon"
      sizes="180x180"
      href="{{ url_for('static', filename='img/apple-touch-icon.png') }}"
    />
    {% block head %}{% endblock %}
  </head>
  <body>
    <nav
      class="navbar navbar-expand-lg navbar-dark bg-dark mb-0"
      id="mainNavbar"
      style="border-bottom: 4px solid var(--bs-primary)"
    >
      <div class="container">
        <a
          class="navbar-brand d-flex align-items-center"
          href="{{ url_for('route.home') }}"
        >
          <img
            src="{{ url_for('static', filename='img/site-icon.png') }}"
            alt="Site"
            class="navbar-logo me-2"
          />
          <span>Home</span>
        </a>
        {% if current_user.is_authenticated %}
        <a
          class="nav-link text-white"
          href="{{ url_for('chat.myChat', email=current_user.email) }}"
          ><i class="bi bi-chat-dots"></i> My Chats</a
        >
        {% endif %}
        <div class="ms-auto d-flex gap-3 align-items-center">
          {% if current_user.is_authenticated %}
          <!-- Show when user is logged in -->
          <div class="dropdown">
            <button
              class="btn btn-outline-light dropdown-toggle d-flex align-items-center"
              type="button"
              id="userDropdown"
              data-bs-toggle="dropdown"
              aria-expanded="false"
            >
              <img
                src="{{ url_for('route.profile_image') }}"
                alt="{{ current_user.username }}"
                class="rounded-circle me-2"
                style="width: 32px; height: 32px; object-fit: cover"
              />
              Welcome&nbsp;<strong>{{ current_user.username }}</strong>
            </button>
            <ul
              class="dropdown-menu dropdown-menu-end"
              aria-labelledby="userDropdown"
            >
              <li>
                <a class="dropdown-item" href="{{ url_for('route.settings') }}">
                  <i class="bi bi-gear me-2"></i>Settings
                </a>
              </li>
              <li><hr class="dropdown-divider" /></li>
              <li>
                <a
                  class="dropdown-item text-danger"
                  href="{{ url_for('auth.logout') }}"
                >
                  <i class="bi bi-box-arrow-right me-2"></i>Logout
                </a>
              </li>
            </ul>
          </div>
          {% else %}
          <!-- Show when user is NOT logged in -->
          <a class="nav-link text-white" href="{{ url_for('auth.signIn') }}"
            ><i class="bi bi-box-arrow-in-right"></i>&nbsp;Sign In</a
          >
          <a class="nav-link text-white" href="{{ url_for('auth.signUp') }}"
            ><i class="bi bi-person-plus"></i>&nbsp;Sign Up</a
          >
          {% endif %}
          <button
            class="btn btn-outline-light"
            id="darkModeToggle"
            type="button"
          >
            <i class="bi bi-moon-fill"></i>
          </button>
        </div>
      </div>
    </nav>

    <!-- Flash Messages -->
    <div class="container mt-3">
      {% with messages = get_flashed_messages(with_categories=true) %} {% if
      messages %} {% for category, message in messages %}
      <div
        class="alert alert-{{ category }} alert-dismissible fade show"
        role="alert"
      >
        {% if category == 'danger' %}
        <i class="bi bi-exclamation-triangle-fill me-2"></i>
        {% elif category == 'success' %}
        <i class="bi bi-check-circle-fill me-2"></i>
        {% elif category == 'warning' %}
        <i class="bi bi-exclamation-circle-fill me-2"></i>
        {% elif category == 'info' %}
        <i class="bi bi-info-circle-fill me-2"></i>
        {% endif %} {{ message }}
        <button
          type="button"
          class="btn-close"
          data-bs-dismiss="alert"
          aria-label="Close"
        ></button>
      </div>
      {% endfor %} {% endif %} {% endwith %}
    </div>

    <div class="container mt-4">{% block content %} {% endblock %}</div>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css"
    />
    <script src="{{ url_for('static', filename='js/darkMode.js') }}"></script>
    {% block scripts %}{% endblock %}
  </body>
</html>
